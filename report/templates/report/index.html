{% extends 'base.html' %} {% load static %} 
{% block title %}
Produksi
{%endblock%} 
{% block breadcrumb %}
<li class="breadcrumb-item">
  <a href="#">Ritasi Hauler</a>
</li>
{% endblock breadcrumb %} 

{% block content %}
<div class="col-xl-12">
  <div id="main-area" class="card">
    <div class="card-header">
      <div class="row">
        <div class="col-md-2">
          <div class="form-group">
            <label>Date</label>
            <input class="form-control" type="date" placeholder="Month data.." onkeyup="if (event.keyCode === 13) { load(); }"
            id="date-select" name="date" value="{% now "Y-m-d" %}" />
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>Shift</label>
            <input type="text" class="form-control" name="shift" id="shift-select" list="shift-list" onkeyup="if (event.keyCode === 13) { load(); }" required>
              <datalist id="jam-list">
                <option value="1"></option>
                <option value="2"></option>
              </datalist>
            </input>
          </div>
        </div>
        <div class="col-md-4">
          <label>&nbsp;</label><br />
          <button
            type="button"
            class="btn btn-info"
            id="btn_filter"
            onclick="load()"
          >
            <i class="feather mr-2 icon-filter"></i>Filter
          </button>
        </div>
        <div class="col text-right">
          <label>&nbsp;</label><br />
          <button type="button" class="btn btn-primary event-btnx m-2" data-bs-toggle="modal" data-bs-target="#exportModal">
            <span class="btn-text"><i class="feather mr-2 icon-download"></i>Download</span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body table-border-style">
      <div class="table-responsive">
        <table class="table table-striped" id="load-table">
          <thead>
            <tr>
              {% comment %} <th class="align-middle bg-primary text-white">Date</th> {% endcomment %}
              <th class="align-middle bg-primary text-white">Unit</th>
              <th class="align-middle bg-primary text-white">WH</th>
              <th class="align-middle bg-primary text-white">HM</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div id="customContextMenu" style="display: none" class="context-menu">
      <ul class="list-group">
        <button class="list-group-item" onclick="split()">Split</button>
        <button class="list-group-item" data-bs-toggle="modal" data-bs-target="#addModal">Add</button>
        {% comment %} <button class="list-group-item">Delete</button> {% endcomment %}
      </ul>
    </div>
  </div>
</div>

{% endblock content %}

{% block script %} 
<script type="text/javascript">
  $('#date-select').on('change',function(){
    sessionStorage.setItem('dateVal',$(this).val())
  })
  $('#shift-select').on('change',function(){
    sessionStorage.setItem('shiftVal',$(this).val())
  })

  const d = new Date()

  let shift = 1

  var dd = String(d.getDate()).padStart(2, "0");
  var mm = String(d.getMonth() + 1).padStart(2, "0"); //January is 0!
  var yyyy = d.getFullYear();

  today = yyyy + "-" + mm + "-" + dd;

  const savedShiftVal = sessionStorage.getItem('shiftVal');
  if (savedShiftVal){
    $("#shift-select").val(savedShiftVal);
  } else {
    $("#shift-select").val(shift);
  }

  const savedDateVal = sessionStorage.getItem('dateVal');
  if (savedDateVal){
    $("#date-select").val(savedDateVal);
  } else {
    $("#date-select").val(today);
  }

  var table = $("#load-table").DataTable({
    processing: true,
    serverSide: true,
    stateSave: true,
    pagingType: "full_numbers",
    ajax: {
      url: "{% url 'report.show' %}",
      type: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
      },
      data: function(d){
        d.date= $("#date-select").val();
        d.shift= $("#shift-select").val();
      },
    },
    columns:[
      {data: "unit", orderable: false, searchable: false},
      {% comment %} {data: "standby_code", orderable: false, searchable: false}, {% endcomment %}
      {data: "durasi", orderable: false, searchable: false},
      {data: "report_date"},
    ],
    language:{
      emptyTable: '<b>Data belum di ambil dari server Jigsaw.</b> Tekan tombol disamping untuk memuat data <button class="btn btn-warning event-btnx m-2" onclick="load_data()"><b>Load</b></button>'
    }
  });

  function load() {
    table.draw();
  }

</script>
{% endblock script %}